{"version":3,"file":"in-viewport-events.service.js","sourceRoot":"","sources":["../src/in-viewport-events.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter, Injectable } from \"@angular/core\";\nimport \"rxjs/add/observable/fromEvent\";\nimport \"rxjs/add/operator/debounceTime\";\nimport { Observable } from \"rxjs/Observable\";\nimport { InViewportService } from \"./in-viewport.service\";\n\n@Injectable()\nexport class InViewportEventsService extends InViewportService {\n  private scrollListener: any;\n  private resizeListener: any;\n  private domListener: any;\n  private roots: Array<any>;\n\n  public trigger$: EventEmitter<any>;\n\n  constructor() {\n    super();\n\n    this.trigger$ = new EventEmitter();\n\n    this.roots = [];\n\n    this.scrollListener = Observable\n      .fromEvent(window, 'scroll', { passive: true })\n      .debounceTime(50)\n      .subscribe((event) => this.onChanges());\n\n    this.resizeListener = Observable\n      .fromEvent(window, 'resize', { passive: true })\n      .debounceTime(50)\n      .subscribe((event) => this.onChanges());\n\n    if (window && 'MutationObserver' in window) {\n      this.domListener = new MutationObserver((mutations) => this.onChanges());\n      // this.domListener.observe(document, {\n      //   attributes: true,\n      //   childList: true,\n      //   characterData: true,\n      //   subtree: true\n      // });\n    }\n  }\n\n  onChanges() {\n    const rootObj = this.findRoot(window);\n    const result = rootObj\n      ? rootObj.targets.map((target: HTMLElement) => ({\n        root: rootObj.root,\n        target\n      }))\n      : [];\n\n    this.trigger$.emit(result);\n  }\n\n  addTarget(target: HTMLElement, rootElement?: HTMLElement | Window) {\n    const root = this.getRoot(rootElement);\n    const rootObj = this.findRoot(root);\n\n    if (rootObj && rootObj.targets.indexOf(target) < 0) {\n      rootObj.targets.push(target);\n    } else {\n      this.roots.push({\n        root,\n        targets: [\n          target\n        ]\n      });\n    }\n  }\n\n  removeTarget(target: HTMLElement, rootElement?: HTMLElement | Window) {\n    const root = this.getRoot(rootElement);\n    const rootObj = this.findRoot(root);\n\n    if (rootObj) {\n      const idx = rootObj.targets.indexOf(target);\n      if (idx >= 0) {\n        rootObj.targets.splice(idx, 1);\n      }\n    }\n  }\n\n  getRoot(rootElement: any) {\n    return (rootElement instanceof HTMLElement) ? rootElement : window;\n  }\n\n  findRoot(root: HTMLElement | Window) {\n    return this.roots.find((item) => item.root === root);\n  }\n}\n"]}