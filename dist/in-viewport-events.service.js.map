{"version":3,"file":"in-viewport-events.service.js","sourceRoot":"","sources":["../src/in-viewport-events.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter, Injectable } from \"@angular/core\";\nimport { Observable } from \"rxjs/Observable\";\nimport { fromEvent } from \"rxjs/observable/fromEvent\";\nimport { debounceTime } from \"rxjs/operator/debounceTime\";\nimport { Subscription } from \"rxjs/Subscription\";\nimport { InViewportService } from \"./in-viewport.service\";\n\n@Injectable()\nexport class InViewportEventsService extends InViewportService {\n  private scroll$: Observable<any>;\n  private scrollSubscription: Subscription;\n  private resize$: Observable<any>;\n  private resizeSubscription: Subscription;\n  private dom$: any;\n  private domSubscription: any;\n  private roots: Array<any>;\n\n  public trigger$: EventEmitter<any>;\n\n  constructor() {\n    super();\n\n    this.trigger$ = new EventEmitter();\n\n    this.roots = [];\n\n    this.scroll$ = fromEvent(window, 'scroll', { passive: true });\n    this.scrollSubscription = debounceTime.call(this.scroll$, 50)\n      .subscribe((event: Event) => this.onChanges());\n\n    this.resize$ = fromEvent(window, 'resize', { passive: true });\n    this.resizeSubscription = debounceTime.call(this.resize$, 50)\n      .subscribe((event: Event) => this.onChanges());\n\n    if (window && 'MutationObserver' in window) {\n      this.dom$ = new MutationObserver((mutations) => this.onChanges());\n      // this.domSubscription = this.dom$.observe(document, {\n      //   attributes: true,\n      //   childList: true,\n      //   characterData: true,\n      //   subtree: true\n      // });\n    }\n  }\n\n  onChanges() {\n    const rootObj = this.findRoot(window);\n    const result = rootObj\n      ? rootObj.targets.map((target: HTMLElement) => ({\n        root: rootObj.root,\n        target\n      }))\n      : [];\n\n    this.trigger$.emit(result);\n  }\n\n  addTarget(target: HTMLElement, rootElement?: HTMLElement | Window) {\n    const root = this.getRoot(rootElement);\n    const rootObj = this.findRoot(root);\n\n    if (rootObj && rootObj.targets.indexOf(target) < 0) {\n      rootObj.targets.push(target);\n    } else {\n      this.roots.push({\n        root,\n        targets: [\n          target\n        ]\n      });\n    }\n  }\n\n  removeTarget(target: HTMLElement, rootElement?: HTMLElement | Window) {\n    const root = this.getRoot(rootElement);\n    const rootObj = this.findRoot(root);\n\n    if (rootObj) {\n      const idx = rootObj.targets.indexOf(target);\n      if (idx >= 0) {\n        rootObj.targets.splice(idx, 1);\n      }\n    }\n  }\n\n  getRoot(rootElement: any) {\n    return (rootElement instanceof HTMLElement) ? rootElement : window;\n  }\n\n  findRoot(root: HTMLElement | Window) {\n    return this.roots.find((item) => item.root === root);\n  }\n}\n"]}